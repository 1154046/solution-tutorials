---
copyright:
  years: 2019
lastupdated: "2019-04-02"
---

{:java: #java .ph data-hd-programlang='java'}
{:swift: #swift .ph data-hd-programlang='swift'}
{:ios: #ios data-hd-operatingsystem="ios"}
{:android: #android data-hd-operatingsystem="android"}
{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}
{:tip: .tip}
{:pre: .pre}
{:important: .important}

# 仮想プライベート・クラウド内のプライベート・サブネットとパブリック・サブネット
{: #vpc-public-app-private-backend}

IBM は、2019 年 4 月上旬に開始する VPC の早期アクセス・プログラムでは、参加を受け付けるお客様の数を限定しますが、数カ月後に利用者数を拡大する予定です。 IBM 仮想プライベート・クラウドの利用をご希望のお客様は、こちらの[応募フォーム](https://{DomainName}/vpc){: new_window} にご記入ください。IBM 担当員から次のステップについてお知らせいたします。
{: important}

このチュートリアルでは、各サブネット内にパブリック・サブネットとプライベート・サブネット、および仮想サーバー・インスタンス (VSI) がある独自の {{site.data.keyword.vpc_full}} (VPC) の作成について順を追って説明します。VPC は、共有クラウド・インフラストラクチャー上の独自のプライベート・クラウドであり、他の仮想ネットワークとは論理的に分離されています。

[サブネット](/docs/infrastructure/vpc?topic=vpc-vpc-glossary#subnet)は IP アドレス範囲です。単一のゾーンにバインドされ、複数のゾーンまたは地域にまたがることはできません。VPC の目的のためのサブネットの重要な特性は、各サブネットは通常の方法で相互接続されると同時に、相互に分離できるということです。サブネット分離は、ファイアウォールとして機能してサブネット間のデータ・パケットのフローを制御するネットワーク・[アクセス制御リスト](/docs/infrastructure/vpc?topic=vpc-vpc-glossary#access-control-list) (ACL) を使用して行えます。同様に、[セキュリティー・グループ](/docs/infrastructure/vpc?topic=vpc-vpc-glossary#security-group) (SG) も仮想ファイアウォールとして機能して、個々の VSI との間のデータ・パケットのフローを制御します。

パブリック・サブネットは、外部に公開する必要があるリソースに使用されます。アクセスが制限されていて、外部からの直接アクセスが禁止されているリソースは、プライベート・サブネット内に置かれます。そのようなサブネット上のインスタンスには、公的にアクセスできないようにするバックエンド・データベースやシークレット・ストアなどがあります。VSI へのトラフィックを許可または拒否するには、SG を定義します。
{:shortdesc}

端的に言うと、VPC を使用して以下のことが可能です。

- ソフトウェア定義ネットワーク (SDN) を作成する
- ワークロードを分離する
- インバウンド・トラフィックとアウトバウンド・トラフィックを細かく制御する

## 達成目標

{: #objectives}

- 仮想プライベート・クラウドに使用できるインフラストラクチャー・オブジェクトを理解する。
- 仮想プライベート・クラウド、サブネット、サーバー・インスタンスの作成方法を学ぶ。
- セキュリティー・グループを適用してサーバーへのアクセスを保護する方法を知る。

## 使用するサービス

{: #services}

このチュートリアルでは、以下のランタイムとサービスを使用します。

- [{{site.data.keyword.vpc_full}}](https://{DomainName}/vpc/provision/vpc)
- [{{site.data.keyword.vsi_is_full}}](https://{DomainName}/vpc/provision/vs)

このチュートリアルでは、費用が発生する場合があります。[料金カリキュレーター](https://{DomainName}/pricing/)を使用して、使用見積もりに基づいてコスト見積もりを生成してください。

## アーキテクチャー
{: #architecture}

![アーキテクチャー](images/solution40-vpc-public-app-private-backend/Architecture.png)


1. 管理者 (DevOps) が、クラウド上に必要なインフラストラクチャー (VPC、サブネット、ルールを定義したセキュリティー・グループ、VSI) をセットアップします。
2. インターネット・ユーザーが、フロントエンド上の Web サーバーに HTTP/HTTPS 要求を行います。
3. フロントエンドは、保護されたバックエンドにプライベート・リソースを要求し、ユーザーに結果を提供します。

## 始める前に

{: #prereqs}

- ユーザー許可を確認してください。VPC リソースを作成および管理するための十分な許可がユーザー・アカウントに付与されていることを確認してください。必要な許可のリストについては、[VPC ユーザーに必要な許可の付与](/docs/infrastructure/vpc?topic=vpc-managing-user-permissions-for-vpc-resources#managing-user-permissions-for-vpc-resources)を参照してください。

- 仮想サーバーに接続するには、SSH 鍵が必要です。SSH 鍵がない場合は、[鍵の作成手順](/docs/infrastructure/vpc?topic=vpc-getting-started-with-ibm-cloud-virtual-private-cloud-infrastructure#prerequisites)を参照してください。

## 仮想プライベート・クラウドの作成
{: #create-vpc}

独自の {{site.data.keyword.vpc_short}} を作成するには、以下のようにします。

1. [「VPC の概要 (VPC overview)」](https://{DomainName}/vpc/overview)ページに移動して、**「VPC を作成します」**をクリックします。
2. **「新規仮想プライベート・クラウド」**セクションで、以下のようにします。
   * VPC の名前として **vpc-pubpriv** を入力します。
   * **「リソース・グループ」**を選択します。
   * オプションで、**「タグ」**を追加してリソースを編成します。
3. VPC のデフォルト・アクセス制御リスト (ACL) として、**「新規デフォルトの作成 (すべて許可)」**を選択します。
1. **デフォルト・セキュリティー・グループ**の SSH と ping のチェック・マークを外します。
4. **「VPC 用の新規サブネット」**で、以下のようにします。
   * 固有の名前として **vpc-pubpriv-backend-subnet** を入力します。
   * ロケーションを選択します。
   * サブネットの IP 範囲を CIDR 表記で入力します (つまり、**10.xxx.0.0/24** のように入力します)。**「アドレス接頭部」**はそのままにして、**「アドレスの数」**として 256 を選択します。
5. サブネットのアクセス制御リスト (ACL) に**「VPC デフォルトの使用」**を選択します。インバウンド・ルールとアウトバウンド・ルールは後で設定できます。
6. **「仮想プライベート・クラウドの作成 (Create virtual private cloud)」**をクリックして、インスタンスをプロビジョンします。

プライベート・サブネットに接続された VSI がソフトウェアをロードするためにインターネットにアクセスする必要がある場合は、パブリック・ゲートウェイを**「接続済み」**に切り替えてください。パブリック・ゲートウェイを接続すると、接続されているすべてのリソースがパブリック・インターネットと通信できるようになります。必要なソフトウェアがすべて VSI に揃ったら、パブリック・ゲートウェイを**「切り離し済み」**に戻して、サブネットがパブリック・インターネットに到達できないようにしてください。
{: important}

サブネットの作成を確認するには、左側のペインの**「サブネット」**をクリックし、状況が**「使用可能」**に変わるまで待ちます。**「サブネット」**の下に新しいサブネットを作成できます。

## バックエンドのセキュリティー・グループと VSI の作成
{: #backend-subnet-vsi}

このセクションでは、バックエンドのセキュリティー・グループと仮想サーバー・インスタンスを作成します。

### バックエンド・セキュリティー・グループの作成

デフォルトでは、VPC と一緒にセキュリティー・グループが作成され、接続されているインスタンスへの SSH (TCP ポート 22) トラフィックと Ping (ICMP タイプ 8) トラフィックがすべて可能になります。

バックエンドの新規セキュリティー・グループを作成するには、以下のようにします。  
1. **「ネットワーク」**の下の**「セキュリティー・グループ」**をクリックし、次に**「新規セキュリティー・グループ」**をクリックします。  
2. 名前として **vpc-pubpriv-backend-sg** を入力し、既に作成した VPC を選択します。  
3. **「セキュリティー・グループの作成」**をクリックします。

このセキュリティー・グループを後で編集して、インバウンド・ルールとアウトバウンド・ルールを追加します。

### バックエンド仮想サーバー・インスタンスの作成

新規に作成されたサブネットで仮想サーバー・インスタンスを作成するには、以下のようにします。

1. **「サブネット」**でバックエンド・サブネットをクリックします。
2. **「接続済みインスタンス」**をクリックしてから、**「新規インスタンス」**をクリックします。
3. 固有の名前を入力し、**vpc-pubpriv-backend-vsi** を選択します。次に、既に作成した VPC を選択し、前と同じ**ロケーション**を選択します。
4. **Ubuntu Linux** イメージを選択し、**「すべてのプロファイル」**をクリックして、**「コンピュート」**で **c-2x4** (vCPU 2 つと RAM 4 GB) を選択します。
5. **「SSH 鍵」**には、既に作成した SSH 鍵を選択します。
6. **「ネットワーク・インターフェース」**で、セキュリティー・グループの横にある**「編集」**アイコンをクリックします。
   * サブネットとして **vpc-pubpriv-backend-subnet** を選択します。
   * デフォルト・セキュリティー・グループのチェック・マークを外し、**vpc-pubpriv-backend-sg** にアクティブのチェック・マークを付けます。
   * **「保存」**をクリックします。
7. **「仮想サーバー・インスタンスの作成 (Create virtual server instance)」**をクリックします。

## フロントエンドのサブネット、セキュリティー・グループ、VSI の作成
{: #frontend-subnet-vsi}

バックエンドと同様に、フロントエンド・サブネットを仮想サーバー・インスタンスとセキュリティー・グループとともに作成します。

### フロントエンドのサブネットの作成

フロントエンドの新規サブネットを作成するには、以下のようにします。

1. 左ペインにある**「ネットワーク」**の下の**「サブネット」**をクリックし、**「新規サブネット」**をクリックします。
   * 名前として **vpc-pubpriv-frontend-subnet** を入力してから、作成済みの VPC を選択します。
   * ロケーションを選択します。
   * サブネットの IP 範囲を CIDR 表記で入力します (つまり、**10.xxx.1.0/24** のように入力します)。**「アドレス接頭部」**はそのままにして、**「アドレスの数」**として 256 を選択します。
1. サブネット・アクセス制御リスト (ACL) には**「VPC デフォルト」**を選択します。インバウンド・ルールとアウトバウンド・ルールは後で設定できます。
1. サブネット内のすべての仮想サーバー・インスタンスに浮動 IP が付加される場合は、サブネットのパブリック・ゲートウェイを使用可能にする必要はありません。仮想サーバー・インスタンスはそれぞれの浮動 IP でインターネットに接続します。
1. **「サブネットの作成」**をクリックしてサブネットをプロビジョンします。

### フロントエンド・セキュリティー・グループの作成

フロントエンドの新規セキュリティー・グループを作成するには、以下のようにします。
1. 「ネットワーク」の**「セキュリティー・グループ」**をクリックしてから、**「新規セキュリティー・グループ」**をクリックします。
2. 名前として **vpc-pubpriv-frontend-sg** を入力し、既に作成した VPC を選択します。
3. **「セキュリティー・グループの作成」**をクリックします。

### フロントエンド仮想サーバー・インスタンスの作成

新規に作成されたサブネットで仮想サーバー・インスタンスを作成するには、以下のようにします。

1. **「サブネット」**でフロントエンド・サブネットをクリックします。
2. **「接続済みインスタンス」**をクリックしてから、**「新規インスタンス」**をクリックします。
3. 固有の名前 **vpc-pubpriv-frontend-vsi** を入力し、既に作成した VPC を選択して、前と同じ**ロケーション**を選択します。
4. **Ubuntu Linux** イメージを選択し、**「すべてのプロファイル」**をクリックして、**「コンピュート」**で **c-2x4** (vCPU 2 つと RAM 4 GB) を選択します。
5. **「SSH 鍵」**には、既に作成した SSH 鍵を選択します。
6. **「ネットワーク・インターフェース」**で、セキュリティー・グループの横にある**「編集」**アイコンをクリックします。
   * サブネットとして **vpc-pubpriv-frontend-subnet** を選択します。
   * デフォルト・セキュリティー・グループのチェック・マークを外し、**vpc-pubpriv-frontend-sg** をアクティブにします。
   * **「保存」**をクリックします。
   * **「仮想サーバー・インスタンスの作成 (Create virtual server instance)」**をクリックします。
7. VSI の状況が**「電源オン」**に変わるまで待ちます。次に、フロントエンド VSI **vpc-pubpriv-frontend-vsi** を選択し、**「ネットワーク・インターフェース」**までスクロールして、**「浮動 IP」**の下の**「予約」**をクリックしてパブリック IP アドレスをフロントエンド VSI に関連付けます。後で参照できるように、関連付けた IP アドレスをクリップボードに保存します。

## フロントエンドとバックエンドの間の接続のセットアップ
{: #setup-connectivity-frontend-backend}

すべてのサーバーが配置されたので、このセクションでは、フロントエンド・サーバーとバックエンド・サーバーの間の通常の操作ができるように接続をセットアップします。

### フロントエンド・セキュリティー・グループの構成

1. **「ネットワーク」**セクションの**「セキュリティー・グループ」**にナビゲートして、**vpc-pubpriv-frontend-sg** をクリックします。
2. まず、**「ルールの追加」**を使用して、以下の**インバウンド**・ルールを追加します。これらのルールは、着信 HTTP 要求と Ping (ICMP) を許可します。

	<table>
   <thead>
      <tr>
         <td><strong> ソース </strong></td>
         <td><strong> プロトコル </strong></td>
         <td><strong>値</strong></td>
      </tr>
   </thead>
   <tbody>
      <tr>
         <td>Any - 0.0.0.0/0</td>
         <td>TCP</td>
         <td>From: <strong>80</strong> To <strong>80</strong></td>
      </tr>
      <tr>
         <td>Any - 0.0.0.0/0</td>
         <td>TCP</td>
         <td>From: <strong>443</strong> To <strong>443</strong></td>
      </tr>
      <tr>
         <td>Any - 0.0.0.0/0</td>
	      <td>ICMP</td>
	      <td>タイプ: <strong>8</strong>、コード: <strong>空のままにする</strong></td>
      </tr>
   </tbody>
   </table>

3. 次に、以下の**アウトバウンド**・ルールを追加します。

   <table>
   <thead>
      <tr>
         <td><strong> 宛先 </strong></td>
         <td><strong> プロトコル </strong></td>
         <td><strong>値</strong></td>
      </tr>
   </thead>
   <tbody>
      <tr>
         <td>タイプ: <strong>セキュリティー・グループ</strong> - 名前: <strong>vpc-pubpriv-backend-sg</strong></td>
         <td>TCP</td>
         <td>バックエンド・サーバーのポート (ヒントを参照)</td>
      </tr>
   </tbody>
   </table>

標準的なバックエンド・サービスのポートは以下のとおりです。MySQL はポート 3306 を使用しており、PostgreSQL はポート 5432 を使用しています。Db2 はポート 50000 または 50001 でアクセスされます。Microsoft SQL Server はデフォルトでポート 1433 を使用します。[一般的なポートのリストは多数ありますが、その 1 つを Wikipedia で参照できます](https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)。
{:tip }

### バックエンド・セキュリティー・グループの構成
フロントエンドと同様に、バックエンドのセキュリティー・グループを構成します。

1. **「ネットワーク」**セクションの**「セキュリティー・グループ」**にナビゲートして、**vpc-pubpriv-backend-sg** をクリックします。
2. **「ルールの追加」**を使用して、次の**インバウンド**・ルールを追加します。このルールは、バックエンド・サービスへの接続を許可します。

   <table>
   <thead>
      <tr>
         <td><strong> ソース </strong></td>
         <td><strong> プロトコル </strong></td>
         <td><strong>値</strong></td>
      </tr>
   </thead>
   <tbody>
      <tr>
         <td>タイプ: <strong>セキュリティー・グループ</strong> - 名前: <strong>vpc-pubpriv-frontend-sg</strong></td>
         <td>TCP</td>
         <td>バックエンド・サーバーのポート</td>
      </tr>
   </tbody>
   </table>


## ソフトウェアのインストールと保守タスクの実行
{: #install-software-maintenance-tasks}

`jump` サーバーとして機能する要塞ホストと保守セキュリティー・グループを使用するサーバーの保護された保守については、[要塞ホストを使用してリモート・インスタンスにセキュアにアクセスする](https://{DomainName}/docs/tutorials?topic=solution-tutorials-vpc-secure-management-bastion-server)に記載されている手順に従ってください。

## リソースの削除
{: #remove-resources}

1. VPC 管理コンソールで、**「浮動 IP」**をクリックし、次に VSI の IP アドレスをクリックしてから、アクション・メニューの**「解放」**を選択します。IP アドレスを解放することを確認します。
2. 次に、**「仮想サーバー・インスタンス」**に切り替え、インスタンスを**削除**します。インスタンスが削除され、しばらくの間、ステータスに**「削除中」**と表示されます。時々ブラウザーを最新表示するようにしてください。
3. VSI が表示されなくなったら、**「サブネット」**に切り替えます。サブネットにパブリック・ゲートウェイが接続されている場合は、サブネット名をクリックします。「サブネットの詳細」でパブリック・ゲートウェイを切り離します。パブリック・ゲートウェイのないサブネットは、概要ページで削除できます。サブネットを削除します。
4. サブネットが削除されたら、**「VPC」**タブに切り替えて、VPC を削除します。

コンソールの使用時、リソース削除後の更新された状況情報を確認するためには、ブラウザーを最新表示しなければならない場合があります。
{:tip}

## チュートリアルを発展させる
{: #expand-tutorial}

このチュートリアルに、追加や拡張が必要ですか。以下にいくつかのアイデアを示します。

- [ロード・バランサー](/docs/infrastructure/vpc?topic=vpc-creating-a-vpc-using-the-ibm-cloud-console#creating-a-load-balancer)を追加して、複数インスタンス間でインバウンド・トラフィックを分配する。
- オンプレミス・ネットワークなどの別のプライベート・ネットワークや別の VPC に VPC を安全に接続できるように、[仮想プライベート・ネットワーク](/docs/infrastructure/vpc?topic=vpc-creating-a-vpc-using-the-ibm-cloud-console#creating-a-vpn) (VPN) を作成する。


## 関連コンテンツ
{: #related}

- [VPC の用語集](/docs/infrastructure/vpc?topic=vpc-vpc-glossary#vpc-glossary)
- [IBM Cloud CLI を使用した VPC の作成](/docs/infrastructure/vpc?topic=vpc-creating-a-vpc-using-the-ibm-cloud-cli#creating-a-vpc-using-the-ibm-cloud-cli)
- [REST API を使用した VPC の作成](/docs/infrastructure/vpc?topic=vpc-creating-a-vpc-using-the-rest-apis#creating-a-vpc-using-the-rest-apis)
